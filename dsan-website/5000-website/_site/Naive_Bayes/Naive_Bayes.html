<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>DSAN-5000: Project – naive_bayes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">DSAN-5000: Project</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Introduction</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about_me/about.html" rel="" target="">
 <span class="menu-text">About Me</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/anly501/dsan-5000-project-qinxuesherry/tree/main/codes" rel="" target="">
 <span class="menu-text">Code</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/anly501/dsan-5000-project-qinxuesherry/tree/main/data" rel="" target="">
 <span class="menu-text">Data</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../data_gathering/data_gathering.html" rel="" target="">
 <span class="menu-text">Data Gathering</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../data_cleaning/data_cleaning.html" rel="" target="">
 <span class="menu-text">Data cleaning</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-clustering" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Clustering</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-clustering">    
        <li>
    <a class="dropdown-item" href="../clustering/clustering1.html" rel="" target="">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../clustering/clustering.html" rel="" target="">
 <span class="dropdown-text">Methods &amp; Codes</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../clustering/Results.html" rel="" target="">
 <span class="dropdown-text">Results Analysis &amp; Conclusion</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../dimensionality_reduction/reduction.html" rel="" target="">
 <span class="menu-text">Dimensionality Reduction</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../decision_trees/tree.html" rel="" target="">
 <span class="menu-text">Decision Trees</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../eda/eda.html" rel="" target="">
 <span class="menu-text">Data Exploration</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../Naive_Bayes/Naive_Bayes.html" rel="" target="" aria-current="page">
 <span class="menu-text">Naïve Bayes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../ARM/ARM.html" rel="" target="">
 <span class="menu-text">ARM</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../conclusion/conclusion.html" rel="" target="">
 <span class="menu-text">Conclusion</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction-to-naive-bayes" id="toc-introduction-to-naive-bayes" class="nav-link active" data-scroll-target="#introduction-to-naive-bayes">Introduction to Naive Bayes:</a>
  <ul class="collapse">
  <li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#statistics-foundation" id="toc-statistics-foundation" class="nav-link" data-scroll-target="#statistics-foundation">Statistics Foundation</a></li>
  <li><a href="#different-variants" id="toc-different-variants" class="nav-link" data-scroll-target="#different-variants">different variants</a></li>
  <li><a href="#how-to-apply-to-my-project" id="toc-how-to-apply-to-my-project" class="nav-link" data-scroll-target="#how-to-apply-to-my-project">How to apply to my Project</a></li>
  </ul></li>
  <li><a href="#record-data-mobile-phone-rating-training" id="toc-record-data-mobile-phone-rating-training" class="nav-link" data-scroll-target="#record-data-mobile-phone-rating-training">Record Data – Mobile Phone Rating Training</a>
  <ul class="collapse">
  <li><a href="#prepare-dataset" id="toc-prepare-dataset" class="nav-link" data-scroll-target="#prepare-dataset">Prepare Dataset</a>
  <ul class="collapse">
  <li><a href="#create-labels" id="toc-create-labels" class="nav-link" data-scroll-target="#create-labels">create labels</a></li>
  <li><a href="#split-data" id="toc-split-data" class="nav-link" data-scroll-target="#split-data">Split data</a></li>
  </ul></li>
  <li><a href="#feature-selection" id="toc-feature-selection" class="nav-link" data-scroll-target="#feature-selection">Feature Selection</a></li>
  <li><a href="#naive-bayes-with-labeled-record-data" id="toc-naive-bayes-with-labeled-record-data" class="nav-link" data-scroll-target="#naive-bayes-with-labeled-record-data">Naive Bayes with Labeled Record Data</a>
  <ul class="collapse">
  <li><a href="#final-result" id="toc-final-result" class="nav-link" data-scroll-target="#final-result">final result</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul></li>
  <li><a href="#text-data-iphone-11-review-training" id="toc-text-data-iphone-11-review-training" class="nav-link" data-scroll-target="#text-data-iphone-11-review-training">Text Data – iphone 11 Review Training</a>
  <ul class="collapse">
  <li><a href="#prepare-dataset-1" id="toc-prepare-dataset-1" class="nav-link" data-scroll-target="#prepare-dataset-1">Prepare Dataset</a>
  <ul class="collapse">
  <li><a href="#create-labels-1" id="toc-create-labels-1" class="nav-link" data-scroll-target="#create-labels-1">create labels</a></li>
  <li><a href="#split-data-1" id="toc-split-data-1" class="nav-link" data-scroll-target="#split-data-1">Split data</a></li>
  </ul></li>
  <li><a href="#feature-selection-1" id="toc-feature-selection-1" class="nav-link" data-scroll-target="#feature-selection-1">Feature Selection</a></li>
  <li><a href="#naive-bayes-with-labeled-text-data" id="toc-naive-bayes-with-labeled-text-data" class="nav-link" data-scroll-target="#naive-bayes-with-labeled-text-data">Naive Bayes with Labeled Text Data</a></li>
  <li><a href="#conclusion-1" id="toc-conclusion-1" class="nav-link" data-scroll-target="#conclusion-1">conclusion</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">



<section id="introduction-to-naive-bayes" class="level1">
<h1>Introduction to Naive Bayes:</h1>
<section id="overview" class="level3">
<h3 class="anchored" data-anchor-id="overview">Overview</h3>
<ul>
<li>The process of training the Naive Bayes algorithm is actually the process of solving each a priori probability P(Ai) and conditional probability P(Bj|Ai), and then in the prediction and classification process, it is only necessary to substitute each probability value obtained during the training process into the Bayesian formula, so as to obtain the relative probability of the results of the classification labels under the current features. The one with higher relative probability is naturally used as the predicted label.</li>
</ul>
</section>
<section id="statistics-foundation" class="level3">
<h3 class="anchored" data-anchor-id="statistics-foundation">Statistics Foundation</h3>
<ul>
<li><span class="math inline">\(P(Y|X) = (P(X|Y) * P(Y))/P(X)\)</span></li>
<li>P(A|B) is called the a posteriori probability, for the target to be found</li>
<li>P(A) is the a priori probability, which can be statistically derived from a large amount of data, or empirically provided when the amount of data is small.</li>
<li>P(B|A) is the conditional probability, which can be statistically derived from a large amount of data, and is usually given by great likelihood estimation, and is actually also the a priori probability</li>
</ul>
</section>
<section id="different-variants" class="level3">
<h3 class="anchored" data-anchor-id="different-variants">different variants</h3>
<ul>
<li><p>Gaussian Naive Bayes: This variant of Naive Bayes is best suited for datasets where the features are continuous and follow a Gaussian or normal distribution. It assigns a Gaussian distribution to each class and predicts the class of a new data point based on these distributions. Common applications include problems that involve continuous variables, as is often found in real-world datasets.</p></li>
<li><p>Multinomial Naive Bayes: This type excels with discrete data and finds frequent application in text categorization tasks, where text is converted into word frequency vectors. However, it can also work with tf-idf vectors. It computes the conditional probability of a word given a class, making it a good choice for problems involving discrete data.</p></li>
<li><p>Bernoulli Naive Bayes: This method is ideal for binary or boolean features and is typically used in text classification tasks where the presence or absence of a word is more important than its frequency. It assumes that all our features are binary-valued and models the input data with a multivariate Bernoulli distribution.</p></li>
</ul>
</section>
<section id="how-to-apply-to-my-project" class="level3">
<h3 class="anchored" data-anchor-id="how-to-apply-to-my-project">How to apply to my Project</h3>
<p>I will use Naive Bayes Algorithmn to train 2 datasets, the objective for using this is for accurately predicting the lebels for my datasets:</p>
<ul>
<li><p>Mobile phone rating: This is a record dataset. There are features like mobiles camera scores, audio scores, display scores, etc, and those related to the customers’ willingness to buy this phone or not. The main goal for training this dataset is for repeict customer’s willingness to buy a phone or not depends on those feature scores.</p></li>
<li><p>Iphone 11 reviews: This is a text dataset. The text are customers reviews. The main goal for this data training is by through the reviews, predict the attitutes of the customers.</p></li>
</ul>
</section>
</section>
<section id="record-data-mobile-phone-rating-training" class="level1">
<h1>Record Data – Mobile Phone Rating Training</h1>
<section id="prepare-dataset" class="level2">
<h2 class="anchored" data-anchor-id="prepare-dataset">Prepare Dataset</h2>
<section id="create-labels" class="level3">
<h3 class="anchored" data-anchor-id="create-labels">create labels</h3>
<p>I create labels for the mobile phone by its rankings</p>
<p>(code in codes/data-cleaning/mobile_phone_rating.ipynb).</p>
<ul>
<li>The top 50 ranking phones is Very Willing</li>
<li>The 51-100 ranking phones is Moderately Willing</li>
<li>The 101-last ranking ophones is Not Willing</li>
</ul>
</section>
<section id="split-data" class="level3">
<h3 class="anchored" data-anchor-id="split-data">Split data</h3>
<p>(code in codes/naive_bayes/mobile_phone_rating_training)</p>
<ul>
<li>I split data into traning set 70%, validation set 15%, and test set 15%.</li>
<li>70% in training will increase the accuracy for the model learning. And the rest each 15% for better identify the training results.</li>
</ul>
</section>
</section>
<section id="feature-selection" class="level2">
<h2 class="anchored" data-anchor-id="feature-selection">Feature Selection</h2>
<p>(code in codes/naive_bayes/mobile_phone_rating_training)</p>
<p>According to the number of features, I found out it nearly has no impact on the trainig. - <img src="../images/mobile_phone_feature_training.png" class="img-fluid" alt="number of features"></p>
<p>Thus I chose to use Vairance Thredhold for this data, after the selection, I find out the optimal thredhold. It turns out the optimal thredhold is 26.51, and the accuracy is around 88%.</p>
</section>
<section id="naive-bayes-with-labeled-record-data" class="level2">
<h2 class="anchored" data-anchor-id="naive-bayes-with-labeled-record-data">Naive Bayes with Labeled Record Data</h2>
<p>(code in codes/naive_bayes/mobile_phone_rating_training)</p>
<ul>
<li>However, after I tried several times for selecting the vairance thredhold, becuase the feature selection process above elimiating some cornor cases, but there are not that many features in my model, if i eliminating them, it would decrease my model accuracy. So after all, I found the optimal thredhold should be 45, so I choose to use that for my model.</li>
<li>In that way, the ‘Selfie’ column will be deducted, which make sense because when I did data cleaning process, there are many nulls and I use the mean to fill null.</li>
</ul>
<section id="final-result" class="level3">
<h3 class="anchored" data-anchor-id="final-result">final result</h3>
<section id="evaluation-matrices" class="level4">
<h4 class="anchored" data-anchor-id="evaluation-matrices">Evaluation Matrices</h4>
<ul>
<li><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../images/mobile_phone_accuracy.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Evaluation Metrics</figcaption>
</figure>
</div></li>
<li>As shown above, the accuracy of my model is 91.3% and which is very high, shows it’s a good model.</li>
<li>Precision is comparely low for the “not will”, but it’s ok, since the number of that labels are not too many.</li>
<li>F-1 score and recall performs well.</li>
<li>Macro Avg: Precision: 86%, Recall: 94%, F1-Score: 89% are all very high schore, shows it’s a good model to fit in.</li>
<li>Weighted Avg: Precision: 93%, Recall: 91% , F1-Score: 92%, shows it’s a good model to fit in.</li>
<li>It did not show any overfitting or underfitting,since the test scores perform well.</li>
</ul>
</section>
<section id="confusion-matrices" class="level4">
<h4 class="anchored" data-anchor-id="confusion-matrices">confusion matrices</h4>
<ul>
<li><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../images/mobile_phone_confusion_matrix.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Confusion Metrics</figcaption>
</figure>
</div></li>
<li>As shown above, the accuracy for predicting labels are very high. Only 2 labels are inaccurately predicted.</li>
</ul>
</section>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>The model predict my dataset well. After he variance Thredhold feature selection, the accuracy increased from about 88% to 91.3%. Also, the model did not show overfitting/underfitting because of its traning accuracy and test accuracy are all around 90%. Thus this model can well predict how those scores impact people’s buying willingness.</p>
</section>
</section>
<section id="text-data-iphone-11-review-training" class="level1">
<h1>Text Data – iphone 11 Review Training</h1>
<section id="prepare-dataset-1" class="level2">
<h2 class="anchored" data-anchor-id="prepare-dataset-1">Prepare Dataset</h2>
<section id="create-labels-1" class="level3">
<h3 class="anchored" data-anchor-id="create-labels-1">create labels</h3>
<p>I create labels for the mobile phone by its ratings</p>
<p>(code in codes/naive_bayes/iphone_11_review_training.ipynb).</p>
<ul>
<li>The top 50 ranking phones is Very Willing</li>
<li>The 51-100 ranking phones is Moderately Willing</li>
<li>The 101-last ranking ophones is Not Willing</li>
</ul>
</section>
<section id="split-data-1" class="level3">
<h3 class="anchored" data-anchor-id="split-data-1">Split data</h3>
<p>(code in codes/naive_bayes/iphone_11_review_training.ipynb).</p>
<ul>
<li>I split data into traning set 80%, and test set 20%.</li>
<li>80% in training will increase the accuracy for the text model learning. Also, 20% of test dataset is enough for giving good results.</li>
</ul>
</section>
</section>
<section id="feature-selection-1" class="level2">
<h2 class="anchored" data-anchor-id="feature-selection-1">Feature Selection</h2>
<p>(code in codes/naive_bayes/iphone_11_review_training.ipynb)</p>
<ul>
<li><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../images/iphone11_review_feature_selection1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">feature selection</figcaption>
</figure>
</div></li>
<li><p>As shown in the graph, when the number of features close to 600-700, the test and training accuracy score did not improve. And after that, the model indicate it’s overfitting because the taining accuracy is high but test accuracy is not that hight. So our opimal feature selection should around 600-700.</p></li>
<li><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../images/iphone11_review_feature_selection2.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">running time</figcaption>
</figure>
</div></li>
<li><p>As shown in the graph, when the number of features close to 1000 the running time increased a lot</p></li>
</ul>
<p>Based on those observation, and also from the accuracy scores of each number of features, I get the optimal number of features are 640. With this feature number, the accuracy and running time are optimal.</p>
</section>
<section id="naive-bayes-with-labeled-text-data" class="level2">
<h2 class="anchored" data-anchor-id="naive-bayes-with-labeled-text-data">Naive Bayes with Labeled Text Data</h2>
<p>(code in codes/naive_bayes/iphone_11_review_training.ipynb)</p>
<ul>
<li><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../images/iphone11_accuracy.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Evaluation Metrics</figcaption>
</figure>
</div></li>
<li>As shown above, the accuracy of my model is 90.11% and which is very high, shows it’s a good model.</li>
<li>Macro Avg: Precision: 65%, Recall: 58%, F1-Score: 61%, those scores are comparedly not perform very well, it is because some low performance for the natural(0) class, this is also make sense, because there are not many data related to that class.</li>
<li>Weighted Avg: Precision: 89%, Recall: 90% , F1-Score: 89%, shows it’s a good model to fit.</li>
</ul>
<section id="confusion-matrices-1" class="level4">
<h4 class="anchored" data-anchor-id="confusion-matrices-1">confusion matrices</h4>
<ul>
<li><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../images/iphone11_confusion_matrix.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Confusion Metrics</figcaption>
</figure>
</div></li>
<li>As shown above, the accuracy for predicting right labels are very high.</li>
<li>In total, 903 data labels were predicted accurately. The model predited well in the positive and negative classes, but did not perform well in the natural class. This is because there are not so many data of natural.</li>
</ul>
</section>
</section>
<section id="conclusion-1" class="level2">
<h2 class="anchored" data-anchor-id="conclusion-1">conclusion</h2>
<p>The model predicts my dataset well. After the number of feature selection methods, the accuracy can reach 90.11%. However, because of the insufficient data related to the natural label class, the prediction for this class did not perform as well as expected.</p>
<p>Also, the model did not show overfitting/underfitting because its training accuracy and test accuracy are all around 90%.</p>
<p>Thus, overall, the model performed well, and it can, based on the text reviews, predict people’s attitudes towards iPhone 11 products.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>